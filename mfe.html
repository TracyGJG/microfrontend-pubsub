<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Micro-frontend Two</title>
  </head>
  <body>
    <h2>iFrame:</h2>
    <h3></h3>

    <div id="message">Please send some message from the input above.</div>
    <br />

    <label for="messageText">Input:</label>
    <input type="text" id="messageText" />
    <br />
    <br />
    <button id="sendMessage" type="button">Send Message</button>

    <script>
      const mfeUrl = new URL(document.baseURI);
      const mfeId = +mfeUrl.searchParams.get('id');
      document.querySelector('h2').textContent += mfeId;

      const publishTopic = `mfe_${mfeId}`;
      const subscribeTopic = (mfeId % 2) + 1;

      document.querySelector(
        'h3'
      ).textContent = `The message received from mfe_${subscribeTopic} appears below:`;
      document.querySelector(
        '#sendMessage'
      ).textContent = `Send above message from ${publishTopic} to mfe_${subscribeTopic}`;

      {
        const $message = document.querySelector('#message');
        const $messageText = document.querySelector('#messageText');

        // Receive from parent
        window.addEventListener('message', function (event) {
          message.innerText =
            typeof event.data === 'string'
              ? event.data
              : JSON.stringify(event.data);
        });

        document
          .querySelector('#sendMessage')
          .addEventListener('click', function () {
            sendToParent({
              id: mfeId,
              data: $messageText.value,
            });
          });
      }

      function sendToParent(message) {
        window.parent.postMessage(JSON.stringify(message), '*');
      }
    </script>
  </body>
</html>
